/* 
DEPT 테이블은 부서 정보를 저장합니다. DEPTNO는 부서 번호, DNAME은 부서 이름, 
LOC는 부서 위치를 나타냅니다. DEPTNO는 기본 키로 설정되어 있습니다. 
EMP 테이블은 직원 정보를 저장합니다. EMPNO는 직원 번호, ENAME은 직원 이름, JOB은 
직책, MGR은 관리자 번호,  
HIREDATE는 입사일, SAL은 급여, COMM은 커미션, DEPTNO는 부서 번호를 나타냅니다. 
EMPNO는 기본 키이고, 
DEPTNO는 DEPT 테이블의 DEPTNO를 참조하는 외래 키입니다 
SALGRADE 테이블은 급여 등급 정보를 저장합니다. GRADE는 등급, LOSAL은 최소 급여, 
HISAL은 최대 급여를 나타냅니다. 
STR_TO_DATE 함수는 MySQL에서 문자열을 날짜 형식으로 변환하는 함수입니다 
'YYYY-MM-DD', 'DD/MM/YYYY', 'MM/DD/YYYY' 등 다양한 형식을 지원 
*/

CREATE TABLE DEPT ( DEPTNO DECIMAL(2), DNAME VARCHAR(14), LOC VARCHAR(13), 
CONSTRAINT PK_DEPT PRIMARY KEY (DEPTNO) ); 
CREATE TABLE EMP ( EMPNO DECIMAL(4),ENAME VARCHAR(10), JOB VARCHAR(9), MGR 
DECIMAL(4), HIREDATE DATE, SAL 
DECIMAL(7,2), COMM DECIMAL(7,2), DEPTNO DECIMAL(2), CONSTRAINT PK_EMP 
PRIMARY 
KEY (EMPNO), CONSTRAINT FK_DEPTNO FOREIGN KEY (DEPTNO) REFERENCES 
DEPT(DEPTNO) 
);  
CREATE TABLE SALGRADE ( GRADE TINYINT, LOSAL SMALLINT, HISAL SMALLINT ); 
INSERT INTO DEPT VALUES (10,'ACCOUNTING','NEW YORK');  
INSERT INTO DEPT VALUES(20,'RESEARCH','DALLAS');  
INSERT INTO DEPT VALUES (30,'SALES','CHICAGO');  
INSERT INTO DEPT VALUES (40,'OPERATIONS','BOSTON');  
INSERT INTO EMP VALUES 
(7369,'SMITH','CLERK',7902,STR_TO_DATE('17-12-1980','%d-%m-%Y'),800,NULL,20); 
INSERT INTO EMP VALUES 
(7499,'ALLEN','SALESMAN',7698,STR_TO_DATE('20-2-1981','%d-%m-%Y'),1600,300,30); 
INSERT INTO EMP VALUES 
(7521,'WARD','SALESMAN',7698,STR_TO_DATE('22-2-1981','%d-%m-%Y'),1250,500,30); 
INSERT INTO EMP VALUES 
(7566,'JONES','MANAGER',7839,STR_TO_DATE('2-4-1981','%d-%m-%Y'),2975,NULL,20); 
INSERT INTO EMP VALUES 
(7654,'MARTIN','SALESMAN',7698,STR_TO_DATE('28-9-1981','%d-%m-%Y'),1250,1400,30); 
INSERT INTO EMP VALUES 
(7698,'BLAKE','MANAGER',7839,STR_TO_DATE('1-5-1981','%d-%m-%Y'),2850,NULL,30); 
INSERT INTO EMP VALUES 
(7782,'CLARK','MANAGER',7839,STR_TO_DATE('9-6-1981','%d-%m-%Y'),2450,NULL,10); 
INSERT INTO EMP VALUES 
(7788,'SCOTT','ANALYST',7566,STR_TO_DATE('13-7-1987','%d-%m-%Y')-85,3000,NULL,20); 
INSERT INTO EMP VALUES 
(7839,'KING','PRESIDENT',NULL,STR_TO_DATE('17-11-1981','%d-%m-%Y'),5000,NULL,10); 
INSERT INTO EMP VALUES 
(7844,'TURNER','SALESMAN',7698,STR_TO_DATE('8-9-1981','%d-%m-%Y'),1500,0,30); 
INSERT INTO EMP VALUES (7876,'ADAMS','CLERK',7788,STR_TO_DATE('13-7-1987', 
'%d-%m-%Y'),1100,NULL,20); INSERT INTO EMP VALUES 
(7900,'JAMES','CLERK',7698,STR_TO_DATE('3-12-1981','%d-%m-%Y'),950,NULL,30); 
INSERT INTO EMP VALUES 
(7902,'FORD','ANALYST',7566,STR_TO_DATE('3-12-1981','%d-%m-%Y'),3000,NULL,20); 
INSERT INTO EMP VALUES 
(7934,'MILLER','CLERK',7782,STR_TO_DATE('23-1-1982','%d-%m-%Y'),1300,NULL,10); 
INSERT INTO SALGRADE VALUES (1,700,1200);  
INSERT INTO SALGRADE VALUES (2,1201,1400);  
INSERT INTO SALGRADE VALUES (3,1401,2000);  
INSERT INTO SALGRADE VALUES (4,2001,3000);  
INSERT INTO SALGRADE VALUES (5,3001,9999);  
COMMIT;  


SELECT * FROM DEPT;
SELECT * FROM EMP;
SELECT * FROM SALGRADE;

SELECT ENAME, HIREDATE
FROM EMP
WHERE DEPTNO IN (SELECT DEPTNO
				FROM EMP
				WHERE ENAME = 'ALLEN')
ORDER BY SAL DESC;

SELECT ENAME, HIREDATE
FROM EMP
WHERE HIREDATE > (SELECT HIREDATE
				  FROM EMP
                  WHERE SAL = (SELECT MAX(SAL)
							   FROM EMP));

SELECT EMPNO, ENAME, SAL
FROM EMP
WHERE SAL > (SELECT MAX(SAL)
			 FROM EMP
             WHERE DEPTNO = 20);

SELECT DEPTNO, COUNT(*)
FROM EMP
GROUP BY DEPTNO
ORDER BY COUNT(*) DESC
LIMIT 1;

SELECT EMPNO
FROM EMP
GROUP BY EMPNO
ORDER BY MAX(MGR) DESC
LIMIT 1;

SELECT ENAME, SAL
FROM EMP
WHERE SAL = (SELECT MAX(SAL)
			 FROM EMP
             WHERE SAL NOT IN (SELECT MAX(SAL)
							   FROM EMP));
                               
SELECT D.DNAME, E.ENAME, HIREDATE
FROM EMP E
INNER JOIN DEPT D
ON D.DEPTNO = E.DEPTNO
WHERE HIREDATE = (SELECT MIN(HIREDATE)
				  FROM EMP
                  WHERE HIREDATE NOT IN (SELECT MIN(HIREDATE)
										 FROM EMP));